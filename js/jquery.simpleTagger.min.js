(function(d){var c={confirmDelete:false,maxNbTags:false,placeholderText:"Add...",caseSensitive:false,disableAdd:false};function b(g,f){this.options=f;this.$select=g;this.$select.hide();this.$select.wrapAll(d('<div class="tagger-container" />'));this.$container=g.parents(".tagger-container");this.$inputContainer=d('<div class="input-container" />');this.$input=d('<input type="text" />');this.$placeholder=d('<span class="placeholder">'+(this.options.placeholderText?this.options.placeholderText:"")+"</span>");this.$inputContainer.append(this.$input).append(this.$placeholder);this.$select.after(this.$inputContainer);var e=this;this.$select.find("option").each(function(){var h=d(this).val();d(this).val(h).text(h);e.addTag(h)});this.setEvents();this.adjustInputWidth()}b.prototype={constructor:b,getTags:function(){var e=[];this.$container.find(".tagger-tag").each(function(){e.push(d(this).data("value"))});return e},findTag:function(f){var e=this;return this.$container.find(".tagger-tag").filter(function(){var h=d.data(this,"value");var g=f;if(e.options.caseSensitive){h=h.toLowerCase();g=g.toLowerCase()}return h===g})},addTag:function(g){var f=false;g=d.trim(g||this.$input.val());if(g!==""){var h=this.findTag(g);if(h.length>0){h.css("opacity",0).animate({opacity:1},300)}else{f=true;var e=this.getCalculatedTag(g);e.data("value",g);this.$inputContainer.before(e);this.inputReset();if(this.$select.find('option[value="'+g+'"]').length===0){this.$select.append('<option value="'+g+'"/>')}}}return f},removeTag:function(e){this.$container.find(".tagger-tag").filter(function(){return d.data(this,"value")===e}).remove();this.$select.find('option[value="'+e+'"]').remove()},removeTags:function(){this.$container.find(".tagger-tag").remove();this.$select.find("option").remove()},setTags:function(e){this.removeTags();for(var f=0;f<e.length;f++){this.addTag(e[f])}},reachedNbMaxTags:function(){return this.options.maxNbTags&&this.getTags().length>=this.options.maxNbTags},addTagFromKeyboard:function(e){if(!this.options.disableAdd){this.addTag(e)}},setEvents:function(){var e=this;if(!this.options.disableAdd){this.$input.on("blur",function(g){e.addTagFromKeyboard(e.$input.val());e.$input.val("");e.$placeholder.show();var f=e.$container.find(".tagger-tag");f.removeClass("confirm");f.last().after(e.$inputContainer)})}this.$input.on("paste",function(g){e.$placeholder.hide();if(e.reachedNbMaxTags()){g.preventDefault();g.stopPropagation()}else{var f=this;setTimeout(function(h){e.adjustInputWidth(d(f).val())},0)}});this.$input.on("keyup",function(f){if(e.$input.val().length===0){e.$placeholder.show()}else{e.$placeholder.hide()}e.adjustInputWidth()});this.$input.on("keydown",function(g){var h=e.$input.val();switch(g.which){case 8:case 46:if(h.length===0){var f;if(g.which===8){f=e.$inputContainer.prev(".tagger-tag")}else{f=e.$inputContainer.next(".tagger-tag")}if(e.options.confirmDelete){f.siblings().removeClass("confirm");if(f.hasClass("confirm")){e.removeTag(f.data("value"))}else{f.addClass("confirm")}}else{e.removeTag(f.data("value"))}}break;case 37:if(h.length===0){e.goToPreviousTag()}break;case 39:if(h.length===0){e.goToNextTag()}break}if(g.keyCode!==8&&g.keyCode!==46){e.$container.find(".tagger-tag").removeClass("confirm")}});this.$input.on("keypress",function(f){var g=e.$input.val();if(f.keyCode!==8&&f.keyCode!==46){e.$container.find(".tagger-tag").removeClass("confirm")}switch(f.keyCode){case 8:case 46:break;case 9:case 13:if(d.trim(e.$input.val())!==""){if(e.addTagFromKeyboard()){e.$placeholder.show()}f.preventDefault();f.stopPropagation()}e.adjustInputWidth();break;default:if(!f.ctrlKey&&e.reachedNbMaxTags()){f.preventDefault();f.stopPropagation()}else{e.$container.find(".tagger-tag").removeClass("confirm");e.$placeholder.hide();e.adjustInputWidth(e.$input.val()+String.fromCharCode(f.which))}break}});this.$container.on("click",function(f){e.$input.focus()});this.$container.on("click",".tagger-tag .remove-tag",function(f){e.removeTag(d(f.target).parents(".tagger-tag").data("value"))})},goToPreviousTag:function(){this.$inputContainer.prevAll(".tagger-tag").first().before(this.$inputContainer);this.inputReset()},goToNextTag:function(){this.$inputContainer.nextAll(".tagger-tag").first().after(this.$inputContainer);this.inputReset()},inputReset:function(f){this.$input.val("");var e=this;setTimeout(function(){e.$input.focus()},10);this.adjustInputWidth()},getCalculatedTag:function(k){var i=d("#tagger-widthCalculator");if(i.length===0){i=d('<div id="tagger-widthCalculator" class="tagger-tag" />').css({position:"absolute",top:-9999,left:-9999,whiteSpace:"nowrap"});d("body").append(i)}var g=function(m){i.html(a(m))};g(k);var h=i.outerWidth();var j=this.$container.width();var l=h>j;var f=this;var e=function(r){g(r);var q=i.outerWidth();if(q<=j){i.html(a(r)+'<span class="remove-tag">&times;</span>');q=i.outerWidth();if(q<=j){return a(r)+'<span class="remove-tag">&times;</span>'}else{return a(r)+'<br /><span class="remove-tag">&times;</span>'}}else{var p=j/q;var s=parseInt(r.length*p,10);g(r.substr(0,s));q=i.outerWidth();var n=false;if(q>j){while(q>j){n=true;s--;g(r.substr(0,s));q=i.outerWidth()}}else{while(q<j){s++;g(r.substr(0,s));q=i.outerWidth()}s--}}var m=r.substr(0,s);var o=m.lastIndexOf(" ");if(o!==-1){s=o}return a(r.substr(0,s))+"<br />"+e(d.trim(r.substr(s)))};return d('<div class="tagger-tag'+(l?" full-width":"")+'">'+e(k)+"</div>")},adjustInputWidth:function(i){i=i||this.$input.val();d("taggerWidth").remove();var h=d("<taggerWidth/>").css({position:"absolute",top:-9999,left:-9999,fontSize:this.$input.css("fontSize"),fontFamily:this.$input.css("fontFamily"),fontWeight:this.$input.css("fontWeight"),letterSpacing:this.$input.css("letterSpacing"),whiteSpace:"nowrap"});h.html(a(i));d("body").append(h);var e=h.width();var f=0;if(this.options.placeholderText){h.html(a(this.options.placeholderText));f=h.width()}var g=Math.max(e,f);var j=this.$input.outerWidth()-this.$input.width();this.$input.width(Math.min(this.$container.width()-j,g+1))}};var a=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/ /g,"&nbsp;")};d.fn.simpleTagger=function(h,f){var e=this;var i=d(this).data("tagger");if(!i){var g=d.extend({},c,h);return this.each(function(){var j=new b(d(this),g);d(this).data("tagger",j)})}else{if(i[h]){return i[h](f)}}}}(window.jQuery));